# Настройка журналов аудита

## Журналы аудита

Журналы аудита располагаются в директории, в которой расположены конфигурационные файлы, созданные после запуска Wizard (см. раздел «[Установка Stingray](./ustanovka_stingray.md)» Руководства по установке и интеграции), в общем случае (по умолчанию):

    <path_to_config_directory>/logs/audit.log

## Управление журналами аудита

Управление журналами аудита производится во время первоначальной установки системы и включает в себя следующие пункты:

* Настройка включения аудита.
* Настройка количества записей в одном файле лога.
* Настройка количества хранимых файлов лога.

### События аудита

События аудита логируются при каждом изменении базы данных в случае любого изменения:

    2021-02-07 21:54:38.364420 Process ID: 39 Event ID: 7, Event Name: Update Record,
    Host: http://localhost:4200, User: admin, Args: {'table': 'User', 'id': 1,
    'fields': {'language': {'before': 'en', 'after': 'ru'}}}

Параметры, представленные в каждой записи:

* Время события — время произошедшего события, в формате YYYY-MM-DD h:m:s (год-месяц-день часы:минуты:секунды).
* Идентификатор процесса — идентификатор процесса, от которого произошло событие, внутри системы.
* Идентификатор события — цифровой идентификатор события.
* Имя события — описание события в человеко-читаемом формате.
* Хост — имя хоста, от которого пришел запрос.
* Имя пользователя — пользователь, от имени которого пришел запрос.
* Аргументы запроса — переданные аргументы запроса, определяющие состояние до и после обновления/изменения/удаления и несущие другой информативный характер.

Перечень всех событий и их описание:

ID|Название|Описание
:-:|-|-
1|Login Success|Событие успешного входа в систему
2|Login Fail|Неуспешная попытка входа в систему
3|Logout|Событие выхода из системы
4|Bad Request|Событие, определяющее неправильное обращение к системе. В информации события указывается код ошибки, которую вернул сервер. Включает в себя события попытки доступа неавторизованного пользователя к ресурсам (код ошибки 401), попытки доступа к ресурсам, для которых у пользователя нет прав (код ошибки 403), а также неверно сформированные запросы (код ошибки 400) и т. д.
5|Server Error|Событие об ошибке сервера с информацией о причине возникновения ошибки
6|New Record|Создание нового элемента в системе. Список возможных элементов, к которым применяется аудит, указан в таблице ниже
7|Update Record|Изменение элемента в системе. Логируется старое и новое значение элемента. Список возможных элементов, к которым применяется аудит, указан в таблице ниже
8|Delete Record|Удаление элемента в системе. Список возможных элементов, к которым применяется аудит, указан в таблице ниже
9|New Related Record|Событие создания новой связанной сущности. В системе присутствует иерархия сущностей и при явном добавлении одного элемента может создаваться несколько дочерних.<br>Для разделения событий создания основных и вложенных сущностей используются различные типы событий
10|Delete Related Record|Событие удаления связанной сущности. В системе присутствует иерархия сущностей и при явном удалении одного элемента может удаляться несколько дочерних. Для разделения событий удаления основных и вложенных сущностей используются различные типы событий
11|Change Password|Событие смены пароля пользователей
12|Dast Action|Событие совершения операций со сканированиями (запуск, остановка, завершение сканирования)
13|Testcase Action|Событие совершения операций с автотестами (запуск, остановка, завершение записи автотеста)

Список элементов, к которым применяются события создания/удаления/модификации:

№|Модель в БД|Описание
:-:|-|-
1|stingray_user|Пользователи системы
2|stingray_project|Проекты
3|stingray_profile|Профили
4|stingray_dast|Сканирования
5|stingray_dastIssue|Уязвимости, выявленные в ходе сканирования
6|stingray_DastResult|Собранные в результате проведения сканирования данные
7|stingray_ProjectIssue|Сущность, связывающая уязвимости между сканированиями
8|stingray_TestCase|Автотесты, записываемые внутри системы
9|stingray_Rule|Правила поиска уязвимостей
10|stingray_RuleModule|Связка правил поиска уязвимостей с модулями для поиска
11|stingray_RuleExpression|Связка правил поиска уязвимостей со строками поиска
12|stingray_Expression|Связка правил поиска уязвимостей с возможными местами поиска
13|stingray_Injection|Строки поиска для определения чувствительной информации
14|stingray_Settings|Настройки системы
15|stingray_RequirementGroup|Стандарты и категории внутри стандартов
16|stingray_Requirement|Требования внутри стандартов